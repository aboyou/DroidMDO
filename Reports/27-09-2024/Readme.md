# گزارش 09/27/2024
### بردار ویژگی Opcode ها
یکی از چالش‌هایی که ما با آن روبرو بودیم آن بود که چه تعداد از Opcode ها مورد بررسی قرار می‌گیرند و آیا به این دلیل ابعاد بردار ویژگی به صورت داینامیک در می‌آید یا نه! با توجه به منطق کد منبع دریافتیم که تعدادی از opcode ها به عنوان opcode هدف در نظر گرفته شده‌اند و تعداد این opcode ها مورد سنجش واقع می‌شود! پس اندازه بردار ویژگی opcode ها نیز به همین تعداد خواهد بود. لیست این opcode ها با نام `smaliOpcode.txt` در این پوشه آپلود شده است.

### روند تابع `analysis_app`
1. ساخت دایرکتوری‌ها: در این مرحله لازم است که دایرکتوری‌های مدنظر برای ذخیره خروجی‌ها (مانند call graph) و ویژگی‌های استخراج شده (permissions, tpl, opcodes) ساخته شود.
2. استخراج call graph: در صورتی که فایل گراف فراخوانی موجود نباشد، این گراف استخراج می‌شود و در پوشه مدنظر ذخیره می‌گردد.
3. بارگذاری گراف فراخوانی: با توجه به این که در برخی موارد گراف فراخوانی از قبل موجود است، صرفا نیاز است تا آن را فراخوانی کنیم.
4. ساخت نگاشت بین گره‌های گراف و method آن‌ها: با توجه به این که هر method در اندروید معادل تابع در بقیه زبان‌هاست، متد مرتبط با گره را استخراج می‌کنیم و نگاشت آن‌ها را ذخیره می‌کنیم.
5. نگاشت بین class ها و method ها: نگاشت بین class ها و method ها را ذخیره می‌کنیم.
6. تعداد opcode های بکار رفته در هر متد را ذخیره می‌کنیم.
7. برای هر class و method، permission های مرتبط را استخراج و ذخیره می‌کنیم.


### کلاس `Permission`
کارایی این کلاس عبارت است از:
- شناسایی APIهای حساس: این کلاس گراف رفاخوانی (call graph) APK را بررسی می‌کند و به دنبال متدهایی مثل query، insert، delete و update می‌گردد که به (Content Providers) مرتبط هستند. این متدها به عنوان بخش‌های حساس برنامه شناسایی می‌شوند.
- بررسی مجوزها: پس از شناسایی این متدها، آنها را با مجوزهایی که در APK تعریف شده‌اند و همچنین URIهای مشخص‌شده برای content providers تطبیق می‌دهد. به این صورت، می‌تواند بررسی کند که کدام مجوزها برای دسترسی به داده‌های حساس مورد نیاز است.
- مدیریت وراثت و بازنویسی (Inheritance and Overriding): با تحلیل سلسله مراتب کلاس‌ها، ابزار اطمینان حاصل می‌کند که مجوزهای لازم برای متدهایی که به ارث رسیده یا بازنویسی شده‌اند به درستی در نظر گرفته شده‌اند. به این ترتیب، اگر متدی در یک کلاس والد پیاده‌سازی شده باشد یا به عنوان بخشی از یک رابط استفاده شده باشد، مجوزهای مرتبط با آن نیز تشخیص داده می‌شوند.
- خروجی: پس از تکمیل تحلیل، نتایج در یک فایل CSV ذخیره می‌شوند که شامل لیستی از APIهای حساس و مجوزهای مورد نیاز آنهاست. این فایل می‌تواند به عنوان مرجع برای بررسی‌های امنیتی استفاده شود تا مطمئن شوید که تمام نقاط دسترسی به داده‌های حساس به درستی محافظت شده‌اند.


## جمع‌بندی
تا کنون گراف فراخوانی هر APK همراه با ویژگی‌های آن‌ها قابل استخراج است. در گام بعدی نیاز است که زیرگراف‌های رفتاری استخراج شوند.
